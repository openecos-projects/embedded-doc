# 开发入门
## 项目概述
星空C1板卡主控芯片采用的是团队自研的[retroSoC](https://github.com/retroSoC/retroSoC)，**它是一个开源的ASIC定制框架，支持接入不同类型的开源RISC-V处理器核（自研或第三方）并进行流片。**当前版本retroSoC内部集成的是国外著名开源RISC-V处理器核[PicoRV32](https://github.com/YosysHQ/picorv32)，其完整了实现RV32IMC指令集，并可以被灵活配置成RV32E、RV32I、RV32IC、RV32IM、RV32IMC等多种组合形式。此外，**retroSoC还包含诸多开源外设模块，如UART、SPI、I2C、GPIO、PWM、LCD等，可实现较为丰富的展示效果。**最后，从整体上看，该板卡主控芯片在功能和性能上基本与ST公司的F1中低端系列相当，但是由于可能存在的软硬件错误，因此当前该板卡仅作为嵌入式原型搭建使用（如内部测试、参加比赛等），务必不要将其应用到实际生产作业环境中。

## 芯片介绍
### 硬件架构
- **处理器核心**：PicoRV32
- **指令集架构**：RISC-V rv32imac
- **工作频率**：72MHz
- **目标架构**：riscv32-unknown-elf

### 内存系统
- **片上 SRAM**：128KB @ 0x00000000-0x0001FFFF
- **外部 PSRAM**：8MB @ 0x04000000-0x047FFFFF (1x8MB)
- **SPI Flash**：16MB @ 0x30000000-0x30FFFFFF

### 外设模块
项目包含丰富的外设驱动模块：

#### 通信接口
- **UART**：标准串口通信（115200 8N1）
- **UART(HP)**：高性能串口
- **SPI**：标准SPI接口
- **HK SPI**：专用SPI控制器
- **I2C**：I2C总线接口
- **PS2**：PS2键盘/鼠标接口

#### 存储与控制
- **GPIO**：16路通用输入输出
- **PWM**：4路脉宽调制输出
- **Timer**：2路定时器（TIM0, TIM1）
- **Flash**：SPI Flash控制器
- **PSRAM**：外部PSRAM控制器

#### 其他
- **RNG**：随机数生成器
- **ArchInfo**：系统架构信息

## 板卡介绍
![](../../../res/img/brd/starry-sky-c/v1.0/brd_func_top.png)

星空C1外设接口介绍如下：

- 系统：
    - 1个电源开关、红色电源指示灯
    - 1个TypeC电源接口（同SoC的UART调试接口）
    - 1个拖拽式烧录器：HFP-LINK
- SoC：
    - 1个24M有源晶振
    - 1个有源晶振焊盘位
    - 1个UART调试接口，使用CP2102进行协议转换
    - 1个4位的CLK配置拨码开关
    - 1个复位按键
    - 1个PS2接口
    - 1个8Mbit的PSRAM
    - 1个128Mbit的SPI Flash
    - 5组IO引脚扇出

## 上电测试
板卡寄出前会进行基线测试，故FLASH中会存储有一个简单的测试程序，用于测试板卡是否正常工作

- **注意**
    - 模式选择开关选择CHIP
    - 时钟配置拨码开关从左至右应为0100
- **上电**
    - 连接TypeC调试接口（用于UART调试）
    - 打开电源开关
    - 检查红色电源指示灯是否亮起
- **测试**
    - 打开串口终端（如Tabby）
    - 配置波特率为115200，数据位8位，无校验位，1位停止位
    - 检查是否能正常输出信息

## 开发流程
1. 开发环境配置
    - 参考[ECOS-SDK仓库](https://github.com/openecos-projects/embedded-sdk)

2. 烧录流程
    - 使用USB数据线将板卡与PC连接
    - FLASH_SEL开关选择MCU
    - 打开板卡电源
    - 将编译好的bin文件拖拽至HFP-LINK的窗口中
    - 等待LED4停止闪烁，检查HFP-LINK窗口中的状态文件是否显示为Success
    ![](../../../res/img/brd/starry-sky-c/v1.0/link_download.png)

3. 启动板卡
    - 断电状态下将FLASH_SEL开关选择chip
    - 打开板卡电源
    - 检查红色电源指示灯是否亮起
    - 打开串口终端（如Tabby）、配置波特率为115200，数据位8位，无校验位，1位停止位
    - 按下复位按键，检查是否能正常输出信息

## PCB原理图
![](../../../res/img/brd/starry-sky-c/v1.0/brd_sch_overview.png)
![](../../../res/img/brd/starry-sky-c/v1.0/brd_sch_power.png)
![](../../../res/img/brd/starry-sky-c/v1.0/brd_sch_chip.png)
![](../../../res/img/brd/starry-sky-c/v1.0/brd_sch_interface.png)
![](../../../res/img/brd/starry-sky-c/v1.0/brd_sch_storage.png)
![](../../../res/img/brd/starry-sky-c/v1.0/brd_sch_periph.png)

## 开发环境配置
参考[ECOS-SDK仓库](https://github.com/openecos-projects/embedded-sdk)

## 外设连接参考
- ST7735-LCD（随板卡附赠）
    - VCC -- 3.3V
    - GND -- GND
    - SCL -- CUST_QSPI_SPI_CLK_O_PAD
    - SDA -- CUST_QSPI_DAT_0_IO_PAD
    - RES -- 3.3V
    - DC  -- GPIO_2_IO_PAD
    - CS  -- CUST_QSPI_SPI_CSN_0_O_PAD
    - BLK -- 3.3V


> 作者：李好（XHTimmo）、缪宇飏（myyerrol）
